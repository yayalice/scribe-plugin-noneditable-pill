define("dom-helpers",["exports"],function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;n="ï»¿",t="text-editor",T=function(e){while(e.firstChild)e.parentNode.insertBefore(e.firstChild,e);return e.parentNode.removeChild(e)},E=function(e){return e===null||e===undefined||e.length===0&&typeof e!="function"||typeof e=="object"&&e.get("length")===0},l=function(e){var t;return t=new e.api.Selection,t.range},s=function(e,t){var n;return n=e.className,n.length>0&&(n+=" "),e.className=n+"non-editable"},v=function(e,t){return e.nodeType===Node.ELEMENT_NODE?(" "+e.className+" ").indexOf(" "+t+" ")>-1:!1},N=function(e,t){var n,r;t==null&&(t="end"),n=t==="beginning"?!0:!1;if(document.createRange)return r=document.createRange(),r.selectNodeContents(e),t!=="none"&&r.collapse(n),i(r);if(document.selection)return r=document.body.createTextRange(),r.moveToElementText(e),t!=="none"&&r.collapse(n),r.select()},i=function(e){var t=new scribe.api.Selection;return t.selection.removeAllRanges(),t.selection.addRange(e),e},b=function(e){var t;return e.children.length===0&&e.childNodes.length<=1&&((t=e.childNodes[0])!=null?t.length:void 0)===0},u=function(e,t){var n,r;t==null&&(t=!0),r=e.startContainer.parentNode,n=e.endContainer.parentNode,e.deleteContents(),b(r)&&t&&$(r).remove();if(b(n)&&t)return $(n).remove()},y=function(e,t){return g(e,o(t)[0])},g=function(e,t){return u(e,!1),e.insertNode(t),t},N=function(e,t){var n;t==null&&(t="end");if(document.createRange)return n=document.createRange(),n.selectNodeContents(e),t!=="none"&&n.collapse(t==="beginning"?!0:!1),i(n)},o=function(e){var t;return t=document.createElement("div"),t.innerHTML=e,t.childNodes},a=function(e,t){while(e&&!v(e,t))e=e.parentNode;return e},p=function(e){while(e){if(v(e,"non-editable"))return e;e=e.parentElement}},w=function(e){return a(e,"non-editable")},m=function(e,t){var r;return r=o('<caret class="non-editable-caret">'+n+"</caret>")[0],t?e.parentElement.insertBefore(r,e):e.parentElement.insertBefore(r,e.nextSibling),r},f=function(e){while(e){if(e.classList&&e.classList.contains("non-editable-caret"))return e;e=e.parentNode}},S=function(e){var t,r,i;return e.parentElement.innerHTML==='<caret class="non-editable-caret">'+n+"</caret>"?$(e.parentElement).html("<br>"):((t=e.childNodes[0])&&t.nodeValue.charAt(0)===n&&(t=t.deleteData(0,1)),i=rangy.saveSelection(this.$("iframe.text-editor-frame")[0].contentWindow),r=$(e).contents(),$(e).replaceWith(r),rangy.restoreSelection(i))},x=function(e){var t,r,i,s,o,u,a;u=new e.api.Selection,o=u.range,s=f(o.startContainer);while(r=e.el.querySelectorAll(".non-editable-caret")){t=r[0];if(r.length===0||t===s&&r.length===1)return;if(t.parentElement.innerHTML==='<caret class="non-editable-caret">'+n+"</caret>"){$(t.parentElement).html("<br>");continue}i=t.childNodes[0],i&&((a=i.nodeValue)!=null?a.charAt(0):void 0)===n&&(i=i.deleteData(0,1)),T(t)}},c=function(e,t){var r,i,s;t==null&&(t=!1);if(!(r=l(e))||!(i=d(r,!0,t)))return;if(r.startOffset===0&&w(i))return i;if(r.startOffset===1&&w(i)&&r.startContainer.textContent.charAt(0)===n)return i},h=function(e,t){var r,i,s;t==null&&(t=!1);if(!(r=l(e))||!(s=d(r,!1,t)))return;i=r.endContainer;if(r.endOffset===i.length&&w(s))return s;if(r.endOffset===i.length-1&&i.nodeValue.charAt(i.nodeValue.length-1)===n&&w(s))return s},d=function(e,n,r){var i,s,o,u,a,f;n==null&&(n=!0),o=function(e){var t;return(e!=null?(t=e.nodeValue)!=null?t.trim().length:void 0:void 0)===0},s=e[n?"startContainer":"endContainer"];while(((u=s[n?"previousSibling":"nextSibling"])===null||o(u))&&((a=s.classList)!=null?!a.contains(t):!void 0))o(u)?s=s[n?"previousSibling":"nextSibling"]:s=s.parentNode;if(r)while((u!=null?(f=u.children)!=null?f.length:void 0:void 0)>0)i=n?u.children.length-1:0,u=u.children[i];return u},e.addClass=s,e.deleteRange=u,e.selectElement=N,e.insertCaretContainer=m,e.hasClass=v,e.getCurrentCaretContainer=f,e.getNonEditableParent=p,e.getNonEditableOnLeft=c,e.getNonEditableOnRight=h,e.getNonEditableParent=p,e.getNonEmptySideNode=d,e.isNonEditable=w,e.removeCaretContainers=x,e.activateRange=i}),define("scribe-plugin-noneditable-pill",["dom-helpers"],function(e){return function(){function s(e){var t=e.firstElementChild;while(t){if(t.classList.contains("non-editable-caret")){var n,r,i;for(r=0,i=t.children.length;r<i;r++)n=t.children[r],n.nodeName==="BR"&&t.removeChild(n)}else s(t);t=t.nextElementSibling}}var t,n,r,i;return t={BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,ESCAPE:27},n=function(){var e;return e=new scribe.api.Selection,e.range},i=function(t){var n=e.getNonEditableParent(t);if(n){var i=document.createRange();return i.setStartBefore(n),i.setEndAfter(n),e.activateRange(i)}return r()},r=function(){var t,n,r,i,s,o,u,a,f;s=function(e,t,n){var r,i,s;r=e.startContainer,s=e.startOffset;if(r.nodeType===Node.TEXT_NODE){i=r.nodeValue.length;if(s>0&&s<i||(n?s===i:s===0))return}return t},e.removeCaretContainers(scribe),f=new scribe.api.Selection;if(!(r=f.range))return;u=e.getNonEditableParent(r.startContainer),o=e.getNonEditableParent(r.endContainer),a=e.getCurrentCaretContainer(r);if(u||o){if(r.collapsed){if(i=s(r,u||o,!0))t=e.insertCaretContainer(i,!0);else if(i=s(r,u||o,!1))t=e.insertCaretContainer(i,!1);if(t){n=t.previousElementSibling===null?"beginning":"end",e.selectElement(t,n);return}}return u&&r.setStartBefore(u),o&&r.setEndAfter(o),e.activateRange(r)}if((a!=null?a.length:void 0)>0&&!e.isNonEditable(e.getNonEmptySideNode(r,!0))&&!e.isNonEditable(e.getNonEmptySideNode(r,!1)))return e.removeCaretContainer(a[0])},function(o){var u;u=new o.api.SimpleCommand("noneditablePill","NONEDITABLE"),u.execute=function(){return o.transactionManager.run(function(){var t,n,r,i;i=new o.api.Selection,n=i.range;if(n.collapsed)return;return r=n.extractContents(),t=document.createElement("pill"),t.appendChild(r),e.addClass(t,"non-editable"),n.insertNode(t),n.selectNode(t),i.selection.removeAllRanges(),i.selection.addRange(n)})},u.queryEnabled=function(){return!0},u.queryState=function(){var t;return t=new o.api.Selection,!!t.getContaining(function(t){return t.nodeName==="PILL"&&e.hasClass(t,"non-editable")}.bind(this))},o.commands.noneditablePill=u,o.registerHTMLFormatter("normalize",function(e){var t=document.createElement("div");return t.innerHTML=e,s(t),t.innerHTML}),o.el.addEventListener("mouseup",function(e){i(e.target)}),o.el.addEventListener("keyup",function(e){r()}),o.el.addEventListener("keydown",function(i){var s,u,a,f,l,c,h,p,d,v,m,g,y,b,w;a=function(n){return function(){if(d){if(p===t.LEFT&&h)return e.selectElement(d,"none"),e.removeCaretContainers(o),i.preventDefault();if(p===t.BACKSPACE)return e.selectElement(d,"none"),e.removeCaretContainers(o)}else if(v&&p===t.BACKSPACE)return e.insertCaretContainer(v,!1)}}(this),f=function(n){return function(){if(y){if(p===t.DELETE)return e.selectElement(y,"none"),e.removeCaretContainers(o);if(p===t.RIGHT&&h)return e.selectElement(y,"none"),e.removeCaretContainers(o),i.preventDefault()}else if(b&&p===t.DELETE&&!y)return e.insertCaretContainer(b,!0)}}(this),c=function(e){return e>=48&&e<=90||e>=96&&e<=111||e>=186&&e<=222},p=i.keyCode,r(),g=n(),h=g.collapsed,w=g.startContainer,u=g.endContainer,m=e.isNonEditable(w)||e.isNonEditable(u),d=e.getNonEditableOnLeft(o),y=e.getNonEditableOnRight(o),v=e.getNonEditableOnLeft(o,!0),b=e.getNonEditableOnRight(o,!0);if((i.metaKey||i.ctrlKey)&&p!==t.DELETE&&p!==t.BACKSPACE)return;if(c(p)||p===t.BACKSPACE||p===t.DELETE){(d||y)&&!h?(s=e.insertCaretContainer(d||y,d?!1:!0),e.deleteRange(g),e.selectElement(s)):m&&e.deleteRange(g);if((p===t.BACKSPACE||p===t.DELETE)&&!h&&m)return i.preventDefault()}return a(),f()})}}});